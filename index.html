<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8">
<title>é›»å½±ç›¸ä¼¼åº¦æ¨è–¦ Demo</title>
<style>
  body { font-family: Arial; margin: 2rem; }
  input { padding: .5rem; width: 300px; }
  .card { border: 1px solid #ddd; padding: 1rem; margin: .5rem 0; border-radius: 8px; }
</style>

<h1>ğŸ¬ é›»å½±ç›¸ä¼¼åº¦æ¨è–¦</h1>
<input id="q" placeholder="è¼¸å…¥é›»å½±åç¨±ï¼Œä¾‹å¦‚ Avatar">
<button onclick="search()">æœå°‹</button>
<!-- âœ… åœ¨é€™è£¡åŠ ç‹€æ…‹æç¤º -->
<div id="status" style="margin:.5rem 0; color:#666;">è³‡æ–™è¼‰å…¥ä¸­â€¦</div>
<div id="results"></div>

<script>
let MOV = [], SIM = {};
let READY = false;

async function boot(){
  try {
    const mj = await fetch("movies.json");
    const sj = await fetch("similar.json");
    if (!mj.ok || !sj.ok) throw new Error("JSON è¼‰å…¥å¤±æ•—");

    MOV = await mj.json();
    SIM = await sj.json();
    READY = true;

    console.log("[DEBUG] MOV length =", MOV.length);
    console.log("[DEBUG] First 5 titles =", MOV.slice(0,5).map(m=>m.title));
    document.getElementById("status").textContent = `è³‡æ–™è¼‰å…¥å®Œæˆï¼š${MOV.length} ç­†`;
  } catch (err) {
    console.error(err);
    document.getElementById("status").textContent = "âŒ è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèª movies.json / similar.json è·¯å¾‘èˆ‡å…§å®¹ã€‚";
  }
}

function search(){
  if (!READY){
    document.getElementById("results").innerHTML = "âŒ› è³‡æ–™é‚„åœ¨è¼‰å…¥ï¼Œç­‰ä¸€ä¸‹å†è©¦ã€‚";
    return;
  }

  const q = document.getElementById("q").value.trim().toLowerCase();
  if (!q){
    document.getElementById("results").innerHTML = "è«‹è¼¸å…¥ç‰‡åé—œéµå­—";
    return;
  }

  // æ¨¡ç³Šï¼‹å¤§å°å¯«å¿½ç•¥
  const candidates = MOV.filter(m => (m.title || "").toLowerCase().includes(q));

  // 1) è‹¥å‰›å¥½åªæ‰¾åˆ°ä¸€éƒ¨ï¼Œç›´æ¥ç”¨å®ƒ
  let movie = null;
  if (candidates.length === 1){
    movie = candidates[0];
  } else if (candidates.length > 1){
    // 2) å¤šå€‹å€™é¸ï¼šå…ˆå˜—è©¦å®Œå…¨ç›¸ç­‰ï¼Œå…¶æ¬¡ç”¨ç¬¬ä¸€å€‹å€™é¸
    movie = candidates.find(m => m.title.toLowerCase() === q) || candidates[0];
  }

  if (!movie){
    // æ‰¾ä¸åˆ° â†’ é¡¯ç¤ºå‰ 10 å€‹å¯èƒ½çš„ç‰‡åï¼ˆç”¨ includes åšå¯¬é¬†æ¯”å°ï¼‰
    const sugg = MOV
      .filter(m => (m.title || "").toLowerCase().includes(q[0] || ""))
      .slice(0,10)
      .map(m => `<li>${m.title}</li>`)
      .join("");

    document.getElementById("results").innerHTML =
      `âŒ æ‰¾ä¸åˆ°é€™éƒ¨é›»å½±ï¼š<b>${q}</b><br>
       <div style="margin-top:.5rem">å¯èƒ½æƒ³æ‰¾ï¼š</div>
       <ul>${sugg || "<li>(ç„¡å€™é¸ï¼Œè«‹æ›é—œéµå­—)</li>"}</ul>`;

    console.log("[DEBUG] query=", q, "candidates.length=", candidates.length);
    return;
  }

  // å–å¾—ç›¸ä¼¼æ¸…å–®ï¼šæ³¨æ„ similar.json çš„ key å¯èƒ½æ˜¯å­—ä¸² id
  const simKey = String(movie.id);
  const sims = SIM[simKey] || [];
  console.log("[DEBUG] chosen movie =", movie, "simKey=", simKey, "sims.length=", sims.length);

  let html = `<h2>ã€Œ${movie.title}ã€çš„ç›¸ä¼¼é›»å½±</h2>`;
  if (sims.length === 0){
    html += `<div>ï¼ˆé€™éƒ¨é›»å½±åœ¨ similar.json è£¡æ²’æœ‰ç›¸ä¼¼æ¸…å–®ï¼Œè«‹ç¢ºèªç›¸ä¼¼åº¦æª”æ¡ˆçš„ key æ˜¯å¦ç”¨ <code>id</code> è€Œä¸æ˜¯ç´¢å¼•ã€‚ï¼‰</div>`;
  } else {
    html += sims.map(s => `
      <div class="card">
        <b>${s.title}</b> <span style="color:#666">score: ${Number(s.score).toFixed(3)}</span>
      </div>
    `).join("");
  }
  document.getElementById("results").innerHTML = html;
}

// äº‹ä»¶
document.getElementById("go").addEventListener("click", search);
document.getElementById("q").addEventListener("keydown", e => { if (e.key === "Enter") search(); });

// å•Ÿå‹•
boot();
</script>

</html>





